{% extends "layouts/main.html" %}

{% block pageTitle %}
Home – {{serviceName}} – GOV.UK Prototype Kit
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">
      How JavaScript loading breaks?
    </h1>
    <p>
      Open your console to see how JavaScript may break depending on the error it contains,
      and how it is loaded.
    </p>
    <h2 class="govuk-heading-l">Interact with the page</h2>
    <p>Some of the scripts will only break when interacting. Click on the button thereafter to trigger such breakage.</p>

    {{ govukButton({
      text: "Simulate interaction",
      type: "button",
      classes: "govuk-button--secondary js-interact-with-me"
    }) }}
    <script>
      // Track when various load-related events get run with respect to scripts loading
      // Most times, they'll run after scripts load, but may run at different times (async, defer...)
      window.addEventListener('DOMContentLoaded', console.log)
      window.addEventListener('load', console.log)
      window.addEventListener('pageshow', console.log)
      // Get some feedback from button interaction
      document.querySelector('.js-interact-with-me').addEventListener('click', function() {
        console.log('Interacted with button')
      })
    </script>
    <h2 class="govuk-heading-l">Configure scenario</h2>
    <form>
      {{ govukRadios({
        name: "script",
        value: script,
        fieldset: {
          legend: {
            text: "How should the script break?"
          }
        },
        items: [
          {
            value: 'no-error',
            text: 'It does not break'
          },
          {
            value: "unparsable",
            text: "Unparsable syntax"
          },
          {
            value: "non-existing-api-initial",
            text: "Non-existing API (initial execution)"
          },
          {
            value: "non-existing-api-interaction",
            text: "Non-existing API (upon interaction)"
          }
        ]
      }) }}
      {{ govukRadios({
        name: "loading_method",
        value: loadingMethod,
        fieldset: {
          legend: {
            text: "How should the script be loaded?"
          }
        },
        items: [
          {
            value: "script-tag",
            html: "Script tag (<code>&lt;script&gt;</code>)"
          },
          {
            value: "script-type-module",
            html: "Module script tag (<code>&lt;script type=\"module\"&gt;</code>)"
          },
          {
            value: "synchronous-import",
            html: "Synchronous import (<code>import \"&lt;SCRIPT_URL&gt;\"</code>)"
          },
          {
            value: "asynchronous-import",
            html: "Asynchronous import (<code>import(\"&lt;SCRIPT_URL&gt;\")</code>)"
          },
          {
            value: "synchronous-named-import",
            html: "Synchronous import (<code>import * as imported from (\"&lt;SCRIPT_URL&gt;\")</code>)"
          }
        ]
      }) }}
      {{ govukInput({
        name: 'delay',
        value: delay,
        label: {
          text: "How many milliseconds should the server delay the response by?"
        },
        classes: "govuk-input--width-5",
        suffix: {
          text: "ms"
        }
      }) }}

      {{ govukButton({
        text: "Load JavaScript"
      }) }}
    </form>

    <script data-position="before" src="/public/javascripts/log-execution.js"></script>
    <script async data-position="before" src="/public/javascripts/log-execution.js"></script>
    <script data-position="before" defer src="/public/javascripts/log-execution.js"></script>
    <script type="module">
      console.log('before', ':', 'module script ran')
    </script>
  
    {% include loadingPartial %}

    <script data-position="after" src="/public/javascripts/log-execution.js"></script>
    <script async data-position="after" src="/public/javascripts/log-execution.js"></script>
    <script data-position="after" defer src="/public/javascripts/log-execution.js"></script>
    <script type="module">
      console.log('after',':', 'module script ran')
    </script>
  </div>
</div>

{% endblock %}
